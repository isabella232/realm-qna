<h2>Realm Question</h2>
<div class="container">
<div class="row">
  <div class="col-xs-8">
<form class="form-inline" action="/write" id="question" method="post">
    <textarea name="question" class="form-control" placeholder="Ask questions here" rows="3"></textarea>
    <button type="submit" class="btn btn-default">Write</button>
</form>

  </div>
  <div class="col-xs-4" id="currentuser">
    currentUser: {{currentUser}}
  </div>
</div>

  <div class="row" id="topbar">
    <div class="col-xs-2">Author</div>
    <div class="col-xs-8">Question</div>
    <div class="col-xs-1">Votes</div>
    <div class="col-xs-1">Action</div>
  </div>


{{#each questions}}
  {{#if isAnswered}}
    <div id="question{{id}}" class="row question answered">
  {{else}}
    <div id="question{{id}}" class="row question">
  {{/if}}

  <div class="col-xs-2">{{author.id}}</div>
  <div class="col-xs-8">{{question}}</div>
  <div class="col-xs-1">{{voteCount}}</div>
  <div class="col-xs-1">

  <span id="vote" onclick="voteQuestion(this.parentNode, {{id}}, 'true')" class="glyphicon glyphicon-thumbs-up hover-color" aria-hidden="true"></span>

  {{#each votes}}
    {{#ifCond id ../../currentUser}}
      <button id="unvote" onclick="voteQuestion(this.parentNode, {{../id}}, 'false')">unvote</button>
    {{/ifCond}}
  {{/each}}
  
  {{#ifCond author.id ../currentUser}}
    <span onclick="edit({{id}})" class="glyphicon glyphicon-pencil hover-color" aria-hidden="true"></span>
    <span onclick="remove({{id}})" class="glyphicon glyphicon-remove hover-color" aria-hidden="true"></span>
  {{/ifCond}}
    </div>
  </div>
{{/each}}
</div>

<script>

function edit(id){
  $('#question'+id).after("<div class='row'> \
  <form method='post'> \
    <div class='col-xs-2'></div> \
    <div class='col-xs-8'> \
    <input type='hidden' name='qid' value="+id+"> \
    <textarea name='question' class='form-control'></textarea> \
    </div> \
    <div class='col-xs-2'><input type='submit'><input type='button' value='cancel' onclick='$(this).parent().parent().parent().remove()'></div> \
  </form> \
  </div>");
  $('#question'+id).next().find("textarea").html( $('#question'+id+' .col-xs-8').html() )

}

function remove(id){
  $('#question'+id).after("<div class='row'> \
  <form method='post'> \
    <div class='col-xs-2'></div> \
    <div class='col-xs-8'> \
    <input type='hidden' name='qid' value="+id+"> \
    <h4>Do you really want to delete this question?</h4> \
    </div> \
    <div class='col-xs-2'><input type='submit' value='yes'><input type='button' value='no' onclick='$(this).parent().parent().parent().remove()'></div> \
  </form> \
  </div>");
  $('#question'+id).next().find("textarea").html( $('#question'+id+' .col-xs-8').html() )

}

function voteQuestion(targetDiv, vid, isVote) {
  var hiddenForm = document.createElement("textarea")
  hiddenForm.setAttribute('type', "text")
  hiddenForm.setAttribute('name', "vid")
  hiddenForm.value = vid
  hiddenForm.style.display = 'none';

  var hiddenFormVote = document.createElement("textarea")
  hiddenFormVote.setAttribute('type', "text")
  hiddenFormVote.setAttribute('name', "isVote")
  
  if (isVote == "true") {
    hiddenFormVote.value = "true"
  }

  hiddenFormVote.style.display = 'none';
  
  var voteForm = document.createElement("form")
  voteForm.setAttribute("method", "post")
  voteForm.appendChild(hiddenForm)
  voteForm.appendChild(hiddenFormVote)
  
  targetDiv.appendChild(voteForm)
  voteForm.submit()
  
  console.log("voteForm.submit()")
}

</script>
